# Developer Quickstart: Git Repository Commit Activity Treemap

**Feature**: 002-commit-treemap  
**Branch**: `002-commit-treemap`  
**Date**: January 31, 2026

This guide helps developers set up, understand, and contribute to the treemap visualization feature.

---

## Prerequisites

Before starting development:

- âœ… Node.js 18+ and npm installed
- âœ… Git installed and available in PATH
- âœ… Modern browser (Chrome 86+, Edge 86+, Safari 15.2+, Firefox 111+)
- âœ… Familiarity with TypeScript, React, and Next.js App Router
- âœ… Understanding of Test-Driven Development (TDD)

---

## Quick Start

### 1. Clone and Install

```bash
# Clone repository
git clone https://github.com/dtanikella/git-explorer.git
cd git-explorer

# Switch to feature branch
git checkout 002-commit-treemap

# Install dependencies
npm install
```

### 2. Verify Setup

```bash
# Run existing tests (should all pass)
npm test

# Start development server
npm run dev
```

Open http://localhost:3000 to see the application.

### 3. Run the Feature

1. In the browser, enter an absolute path to a git repository (e.g., `/Users/yourname/projects/some-repo`)
2. Click "Analyze Repository"
3. Wait for the treemap visualization to appear (~2-10 seconds depending on repo size)
4. View the commit frequency treemap with color gradient

---

## Project Structure

```
git-explorer/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx                      # â­ Main page (repo selector + treemap display)
â”‚   â”œâ”€â”€ layout.tsx                    # Root layout
â”‚   â”œâ”€â”€ globals.css                   # Global styles
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ git-analysis/
â”‚   â”‚       â””â”€â”€ route.ts              # â­ API: Git analysis endpoint
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ RepositorySelector.tsx    # â­ User input for repo path
â”‚       â”œâ”€â”€ TreemapChart.tsx          # â­ Visx treemap visualization
â”‚       â”œâ”€â”€ LoadingState.tsx          # Loading spinner
â”‚       â””â”€â”€ DateRangeSelector.tsx     # (P2 - not in MVP)
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ git/
â”‚   â”‚   â”œâ”€â”€ analyzer.ts               # â­ simple-git wrapper, commit counting
â”‚   â”‚   â”œâ”€â”€ tree-builder.ts           # â­ Build hierarchical tree from files
â”‚   â”‚   â””â”€â”€ types.ts                  # â­ TypeScript interfaces
â”‚   â”œâ”€â”€ treemap/
â”‚   â”‚   â”œâ”€â”€ color-scale.ts            # â­ Dark green â†’ light gray gradient
â”‚   â”‚   â””â”€â”€ data-transformer.ts       # Transform git data to visx format
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ date-helpers.ts           # Date range calculations
â”‚
â”œâ”€â”€ __tests__/
â”‚   â”œâ”€â”€ unit/                         # â­ Test data transformation logic
â”‚   â”œâ”€â”€ integration/                  # â­ Test API routes
â”‚   â””â”€â”€ components/                   # â­ Test React components
â”‚
â”œâ”€â”€ specs/002-commit-treemap/
â”‚   â”œâ”€â”€ spec.md                       # Feature specification
â”‚   â”œâ”€â”€ plan.md                       # This implementation plan
â”‚   â”œâ”€â”€ research.md                   # Technology decisions
â”‚   â”œâ”€â”€ data-model.md                 # Entity definitions
â”‚   â”œâ”€â”€ contracts/                    # API and component contracts
â”‚   â””â”€â”€ tasks.md                      # (Generated by /speckit.tasks)
â”‚
â””â”€â”€ package.json                      # Dependencies

â­ = Files you'll create or modify for this feature
```

---

## Development Workflow (TDD)

This project follows strict Test-Driven Development per the constitution:

### Red-Green-Refactor Cycle

```
1. ðŸ”´ RED: Write a failing test
   â””â”€ Describe the desired behavior
   
2. ðŸŸ¢ GREEN: Write minimal code to pass
   â””â”€ Implement just enough to make test pass
   
3. ðŸ”µ REFACTOR: Clean up code
   â””â”€ Improve structure without changing behavior
```

### Example: Adding a Feature

**Scenario**: Implement commit counting logic

**Step 1: Write Test (RED)**

```typescript
// __tests__/unit/git-analyzer.test.ts
import { countCommitsByFile } from '@/lib/git/analyzer';

describe('countCommitsByFile', () => {
  it('counts unique commit SHAs per file', () => {
    const commits = [
      { sha: 'abc123', files: ['src/App.tsx', 'src/utils.ts'] },
      { sha: 'def456', files: ['src/App.tsx'] },
      { sha: 'ghi789', files: ['src/Button.tsx'] },
    ];
    
    const result = countCommitsByFile(commits);
    
    expect(result.get('src/App.tsx')).toBe(2);
    expect(result.get('src/utils.ts')).toBe(1);
    expect(result.get('src/Button.tsx')).toBe(1);
  });
});
```

**Run**: `npm test` â†’ Test fails (function doesn't exist) âœ… RED

**Step 2: Implement (GREEN)**

```typescript
// lib/git/analyzer.ts
export function countCommitsByFile(commits: CommitRecord[]): Map<string, number> {
  const counts = new Map<string, number>();
  
  for (const commit of commits) {
    for (const file of commit.files) {
      counts.set(file, (counts.get(file) || 0) + 1);
    }
  }
  
  return counts;
}
```

**Run**: `npm test` â†’ Test passes âœ… GREEN

**Step 3: Refactor (BLUE)**

```typescript
// Improve readability, add types
export function countCommitsByFile(
  commits: readonly CommitRecord[]
): ReadonlyMap<string, number> {
  const counts = new Map<string, number>();
  
  commits.forEach(({ files }) => {
    files.forEach(file => {
      counts.set(file, (counts.get(file) || 0) + 1);
    });
  });
  
  return counts;
}
```

**Run**: `npm test` â†’ Test still passes âœ… REFACTOR

---

## Running Tests

```bash
# Run all tests
npm test

# Run tests in watch mode (recommended during development)
npm test -- --watch

# Run tests with coverage
npm test -- --coverage

# Run specific test file
npm test -- git-analyzer.test.ts

# Run tests matching pattern
npm test -- --testNamePattern="counts commits"
```

---

## Key Implementation Files

### 1. Git Analysis API Route

**File**: `app/api/git-analysis/route.ts`

**Responsibilities**:
- Validate repository path
- Check for .git folder
- Call git analyzer
- Return tree data or error

**Test First**:
```bash
# Create test
touch __tests__/integration/git-analysis-api.test.ts

# Write tests, then implement
npm test -- git-analysis-api.test.ts --watch
```

### 2. Git Analyzer

**File**: `lib/git/analyzer.ts`

**Responsibilities**:
- Execute `git log` via simple-git
- Parse commit records
- Count commits per file
- Filter top 500 files

**Test First**:
```bash
touch __tests__/unit/git-analyzer.test.ts
npm test -- git-analyzer.test.ts --watch
```

### 3. Tree Builder

**File**: `lib/git/tree-builder.ts`

**Responsibilities**:
- Build hierarchical tree from flat file list
- Aggregate commit counts in parent folders
- Preserve folder structure

**Test First**:
```bash
touch __tests__/unit/tree-builder.test.ts
npm test -- tree-builder.test.ts --watch
```

### 4. Color Scale

**File**: `lib/treemap/color-scale.ts`

**Responsibilities**:
- Calculate frequency scores (recent commits / max recent)
- Map scores to colors (dark green â†’ light gray)
- Return hex color strings

**Test First**:
```bash
touch __tests__/unit/color-scale.test.ts
npm test -- color-scale.test.ts --watch
```

### 5. Treemap Component

**File**: `app/components/TreemapChart.tsx`

**Responsibilities**:
- Render visx Treemap with tree data
- Apply colors to rectangles
- Handle empty state

**Test First**:
```bash
touch __tests__/components/TreemapChart.test.tsx
npm test -- TreemapChart.test.tsx --watch
```

---

## Dependencies

### Core Dependencies (Already Installed)

```json
{
  "@visx/group": "^3.12.0",
  "@visx/hierarchy": "^3.12.0",
  "@visx/scale": "^3.12.0",
  "next": "16.1.6",
  "react": "19.2.3"
}
```

### New Dependencies to Install

```bash
# Install simple-git for git operations
npm install simple-git

# Install types
npm install --save-dev @types/d3-scale
```

---

## Debugging Tips

### 1. Git Analysis Not Working

**Check**:
- Is git installed? Run `git --version` in terminal
- Does the server have read access to the repository path?
- Is the path absolute? Relative paths won't work.

**Debug**:
```typescript
// Add logging to app/api/git-analysis/route.ts
console.log('Analyzing repo at:', repoPath);
console.log('Time range:', timeRange);
```

### 2. Treemap Not Rendering

**Check**:
- Are there errors in browser console?
- Does `treeData` have the expected structure? Log it:
  ```typescript
  console.log('Tree data:', JSON.stringify(treeData, null, 2));
  ```
- Is visx installed? Run `npm list @visx/hierarchy`

### 3. Tests Failing

**Check**:
- Are you running tests in watch mode? `npm test -- --watch`
- Did you forget to import a type or function?
- Is the test file in the correct directory (`__tests__/`)?

---

## Common Tasks

### Add a New Component

1. **Write test first**:
   ```bash
   touch __tests__/components/MyComponent.test.tsx
   ```

2. **Write failing test**:
   ```typescript
   import { render, screen } from '@testing-library/react';
   import MyComponent from '@/app/components/MyComponent';
   
   test('renders hello world', () => {
     render(<MyComponent />);
     expect(screen.getByText('Hello World')).toBeInTheDocument();
   });
   ```

3. **Run test** (should fail): `npm test -- MyComponent.test.tsx`

4. **Create component**:
   ```bash
   touch app/components/MyComponent.tsx
   ```

5. **Implement** to pass test

6. **Refactor** if needed

### Add a New Utility Function

1. **Write test first**:
   ```bash
   touch __tests__/unit/my-util.test.ts
   ```

2. **Write failing test**:
   ```typescript
   import { myUtil } from '@/lib/utils/my-util';
   
   test('does something useful', () => {
     expect(myUtil(42)).toBe(84);
   });
   ```

3. **Implement** in `lib/utils/my-util.ts`

4. **Run test** until it passes

---

## Architecture Decisions

See [research.md](research.md) for detailed rationale. Key decisions:

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Repo input | Text input (absolute path) | Simpler than File System Access API for local dev server |
| Git library | simple-git | Industry standard, well-typed, supports date filtering |
| Visualization | @visx/hierarchy | Already installed, React-friendly wrapper around d3 |
| Color scale | Sequential (dark green â†’ light gray) | Shows frequency clearly, accessible |
| State management | React useState at page level | YAGNI - no external library needed for simple state |
| Testing | Jest + React Testing Library | Already configured, supports TDD workflow |

---

## Performance Guidelines

Per success criteria:

- **Analysis**: <10 seconds for 10,000 files
- **Updates**: <5 seconds when changing time range
- **Optimization strategy**: Measure first, optimize if needed (don't premature optimize)

**If performance issues arise**:
1. Profile with Chrome DevTools
2. Consider caching git log results
3. Consider Web Worker for git processing
4. Consider pagination/virtualization for huge repos

---

## Code Style

Follow existing project conventions:

- **TypeScript**: Strict mode enabled, no `any` types
- **Formatting**: Prettier (run `npm run format`)
- **Linting**: ESLint (run `npm run lint`)
- **Naming**: 
  - Components: PascalCase (`TreemapChart`)
  - Functions: camelCase (`buildTree`)
  - Files: Match export name (`TreemapChart.tsx`)
  - Tests: Match source file (`TreemapChart.test.tsx`)

---

## Getting Help

- **Spec questions**: See [spec.md](spec.md)
- **Architecture questions**: See [research.md](research.md) and [plan.md](plan.md)
- **API contracts**: See [contracts/](contracts/)
- **Data model**: See [data-model.md](data-model.md)
- **Task breakdown**: See [tasks.md](tasks.md) (generated after planning)

---

## Next Steps

1. âœ… Read this quickstart
2. âœ… Verify environment setup (`npm test`, `npm run dev`)
3. âœ… Review [spec.md](spec.md) to understand user stories
4. âœ… Review [data-model.md](data-model.md) to understand entities
5. â†’ Run `/speckit.tasks` to generate task breakdown
6. â†’ Start implementing tasks following TDD workflow
7. â†’ Mark tasks complete as you go

---

**Remember**: Tests first, always. The constitution is non-negotiable on TDD. ðŸ§ª
